import{r as b,R as N,u as A,j as i,c as ee}from"../../../../index-C0mdIfWc.js";import{h as te,a as U,b as w,e as ne,E as re,g as M,s as oe,i as se,z as x,j as R,c as ie,k as ae,l as ce,d as le}from"../../../../web-app-DnuSsBjl.js";import{l as ue,c as H,a as de,h as $}from"../../../../message-bus-fCsfo-jD.js";import{f as fe,m as me,s as pe,$ as he,d as ge,E as ve,e as Se,p as ye,S as xe,a as be,b as Ee,P as we,A as _e,g as Ae,c as Ce}from"../../../../Spinner-CfWM94WA.js";import{d as je}from"../../../../debug-2TAL0-aY.js";const J="/assets/logo_transparent-BEyjmzpO.png";var Ne={VITE_WEB_URL:"https://eurosaver.net",VITE_WS_URL:"https://realtime.eurosaver.net/ws",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,IS_FIREFOX:!0,EUROSAVER_VERSION:"1.4.4"};const V=e=>{let t;const n=new Set,o=(l,h)=>{const v=typeof l=="function"?l(t):l;if(!Object.is(v,t)){const m=t;t=h??(typeof v!="object"||v===null)?v:Object.assign({},t,v),n.forEach(g=>g(t,m))}},r=()=>t,d={setState:o,getState:r,getInitialState:()=>p,subscribe:l=>(n.add(l),()=>n.delete(l)),destroy:()=>{(Ne?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},p=t=e(o,r,d);return d},Oe=e=>e?V(e):V;var X={exports:{}},K={},q={exports:{}},G={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _=b;function Ie(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Re=typeof Object.is=="function"?Object.is:Ie,De=_.useState,Pe=_.useEffect,Te=_.useLayoutEffect,Le=_.useDebugValue;function Ue(e,t){var n=t(),o=De({inst:{value:n,getSnapshot:t}}),r=o[0].inst,s=o[1];return Te(function(){r.value=n,r.getSnapshot=t,D(r)&&s({inst:r})},[e,n,t]),Pe(function(){return D(r)&&s({inst:r}),e(function(){D(r)&&s({inst:r})})},[e]),Le(n),n}function D(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Re(e,n)}catch{return!0}}function ze(e,t){return t()}var Fe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?ze:Ue;G.useSyncExternalStore=_.useSyncExternalStore!==void 0?_.useSyncExternalStore:Fe;q.exports=G;var Me=q.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O=b,ke=Me;function $e(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Ve=typeof Object.is=="function"?Object.is:$e,Be=ke.useSyncExternalStore,We=O.useRef,He=O.useEffect,Je=O.useMemo,Xe=O.useDebugValue;K.useSyncExternalStoreWithSelector=function(e,t,n,o,r){var s=We(null);if(s.current===null){var u={hasValue:!1,value:null};s.current=u}else u=s.current;s=Je(function(){function d(m){if(!p){if(p=!0,l=m,m=o(m),r!==void 0&&u.hasValue){var g=u.value;if(r(g,m))return h=g}return h=m}if(g=h,Ve(l,m))return g;var c=o(m);return r!==void 0&&r(g,c)?g:(l=m,h=c)}var p=!1,l,h,v=n===void 0?null:n;return[function(){return d(t())},v===null?void 0:function(){return d(v())}]},[t,n,o,r]);var a=Be(e,s[0],s[1]);return He(function(){u.hasValue=!0,u.value=a},[a]),Xe(a),a};X.exports=K;var Ke=X.exports;const qe=te(Ke);var Z={VITE_WEB_URL:"https://eurosaver.net",VITE_WS_URL:"https://realtime.eurosaver.net/ws",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,IS_FIREFOX:!0,EUROSAVER_VERSION:"1.4.4"};const{useDebugValue:Ge}=N,{useSyncExternalStoreWithSelector:Ze}=qe;let B=!1;const Qe=e=>e;function Ye(e,t=Qe,n){(Z?"production":void 0)!=="production"&&n&&!B&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),B=!0);const o=Ze(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return Ge(o),o}const et=e=>{(Z?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof e=="function"?Oe(e):e,n=(o,r)=>Ye(t,o,r);return Object.assign(n,t),n},tt=e=>et;var P={VITE_WEB_URL:"https://eurosaver.net",VITE_WS_URL:"https://realtime.eurosaver.net/ws",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,IS_FIREFOX:!0,EUROSAVER_VERSION:"1.4.4"};const z=new Map,j=e=>{const t=z.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([n,o])=>[n,o.getState()])):{}},nt=(e,t,n)=>{if(e===void 0)return{type:"untracked",connection:t.connect(n)};const o=z.get(n.name);if(o)return{type:"tracked",store:e,...o};const r={connection:t.connect(n),stores:{}};return z.set(n.name,r),{type:"tracked",store:e,...r}},rt=(e,t={})=>(n,o,r)=>{const{enabled:s,anonymousActionType:u,store:a,...d}=t;let p;try{p=(s??(P?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!p)return(P?"production":void 0)!=="production"&&s&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),e(n,o,r);const{connection:l,...h}=nt(a,p,d);let v=!0;r.setState=(c,S,f)=>{const y=n(c,S);if(!v)return y;const I=f===void 0?{type:u||"anonymous"}:typeof f=="string"?{type:f}:f;return a===void 0?(l?.send(I,o()),y):(l?.send({...I,type:`${a}/${I.type}`},{...j(d.name),[a]:r.getState()}),y)};const m=(...c)=>{const S=v;v=!1,n(...c),v=S},g=e(r.setState,o,r);if(h.type==="untracked"?l?.init(g):(h.stores[h.store]=r,l?.init(Object.fromEntries(Object.entries(h.stores).map(([c,S])=>[c,c===h.store?g:S.getState()])))),r.dispatchFromDevtools&&typeof r.dispatch=="function"){let c=!1;const S=r.dispatch;r.dispatch=(...f)=>{(P?"production":void 0)!=="production"&&f[0].type==="__setState"&&!c&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),c=!0),S(...f)}}return l.subscribe(c=>{var S;switch(c.type){case"ACTION":if(typeof c.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return T(c.payload,f=>{if(f.type==="__setState"){if(a===void 0){m(f.state);return}Object.keys(f.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const y=f.state[a];if(y==null)return;JSON.stringify(r.getState())!==JSON.stringify(y)&&m(y);return}r.dispatchFromDevtools&&typeof r.dispatch=="function"&&r.dispatch(f)});case"DISPATCH":switch(c.payload.type){case"RESET":return m(g),a===void 0?l?.init(r.getState()):l?.init(j(d.name));case"COMMIT":if(a===void 0){l?.init(r.getState());return}return l?.init(j(d.name));case"ROLLBACK":return T(c.state,f=>{if(a===void 0){m(f),l?.init(r.getState());return}m(f[a]),l?.init(j(d.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return T(c.state,f=>{if(a===void 0){m(f);return}JSON.stringify(r.getState())!==JSON.stringify(f[a])&&m(f[a])});case"IMPORT_STATE":{const{nextLiftedState:f}=c.payload,y=(S=f.computedStates.slice(-1)[0])==null?void 0:S.state;if(!y)return;m(a===void 0?y:y[a]),l?.send(null,f);return}case"PAUSE_RECORDING":return v=!v}return}}),g},ot=rt,T=(e,t)=>{let n;try{n=JSON.parse(e)}catch(o){console.error("[zustand devtools middleware] Could not parse the received json",o)}n!==void 0&&t(n)};function Q(){const e=tt()(ot(n=>({articles:[],updateArticle:o=>n(r=>({articles:[...r.articles.filter(s=>s.country.id!==o.country.id),o]}))}),{name:"article-store"}));return{useArticleStore:e,initializeArticleStore:()=>{const n=U(location.href);n&&ue(n).then(o=>{o.forEach(r=>{e.getState().updateArticle(r)}),w.storage.onChanged.addListener((r,s)=>{for(const[u,{oldValue:a,newValue:d}]of Object.entries(r))u.startsWith(`eurosaver:article:${n}:`)&&e.getState().updateArticle(d)})})}}}const C={level:0,name:"",bgColor:"bg-gray-200",textColor:"text-gray-200"},E=[{level:1,name:"Nice",bgColor:"bg-green-600",textColor:"text-green-600"},{level:2,name:"OK",bgColor:"bg-green-500",textColor:"text-green-500"},{level:3,name:"Fair",bgColor:"bg-lime-500",textColor:"text-lime-500"},{level:4,name:"Little too much",bgColor:"bg-yellow-500",textColor:"text-yellow-500"},{level:5,name:"Expensive",bgColor:"bg-red-600",textColor:"text-red-600"}],st=(e,t)=>{if(e<0||e>t)return E[0]??C;if(t<E.length)return E[e]??C;const n=+((t-e)*(E.length-1)/(t-1)).toFixed(0);return E[E.length-n]??C};function it(e,t){if(e.length<=3)return e;const n=[...new Set(e)].sort((s,u)=>s-u),o=n[0]??0,r=n[n.length-1]??0;if(t===o||t===r){const s=Math.floor(n.length/2);return[o,n[s]??0,r]}else return[o,t,r]}const{useArticleStore:at,initializeArticleStore:ct}=Q();function lt(e){const t=at(c=>c.articles),[n]=A("countriesToHide",""),o=M(),[r]=A("includeShippingCostsDefault",!1),[s,u]=A("includeShippingCosts",!1);b.useEffect(()=>{r&&u(r)},[r,u]),b.useEffect(()=>{ct()},[]);const a=ne.find(c=>c.id==e.amazonCountry)?.currency??re,d=b.useMemo(()=>{const S=fe(t,n).map(y=>me(y,a,e.currencyInfo.rates));return pe(S,s)},[t,s,e.currencyInfo.rates,a,n]),p=Array.from(new Set(d.map(c=>s?c.convertedPrice+c.convertedShipping:c.convertedPrice))),l=d.find(c=>c.country.id==e.amazonCountry),h=s?(l?.convertedPrice??0)+(l?.convertedShipping??0):l?.convertedPrice??0,v=p.findIndex(c=>c==h),m=h<=0?C:st(v,p.length),g=b.useMemo(()=>it(p,h),[h,p]);return i.jsx(i.Fragment,{children:i.jsx("div",{className:"mb-1 flex flex-row gap-1",children:i.jsxs(he,{openDelay:150,closeDelay:100,children:[i.jsx(ge,{asChild:!0,children:i.jsx("div",{className:"flex flex-row gap-1",children:E.map(c=>i.jsx(ve,{className:`h-4 rounded-full ${c.level<=m.level?m.textColor:C.textColor} text-center`},c.level))})}),i.jsx(Se,{side:"top",align:"center",sideOffset:5,className:"z-10 space-y-3 rounded-lg border bg-white p-4 shadow-lg",children:i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsx("a",{href:o,target:"_blank",rel:"noreferrer",className:"whitespace-nowrap font-bold text-orange-500 hover:underline",children:i.jsx("img",{src:new URL(J,import.meta.url).href,alt:"EuroSaver Logo",width:2569,height:504,className:"mx-auto my-auto h-5 w-auto flex-none rounded object-cover"})}),i.jsx("div",{className:"flex flex-row gap-1",children:g.map((c,S)=>i.jsxs("div",{className:`rounded-md px-2 py-1 text-sm ${c===h?"text-zinc bg-zinc-100 font-medium":"text-zinc-400"}`,children:[c<=0?"-":ye({value:c,currency:a}),S===0&&g.length>1&&i.jsx("span",{className:"ml-1 text-xs",children:"min"}),S===1&&g.length>2&&c!==h&&i.jsx("span",{className:"ml-1 text-xs",children:"mdn"}),S===g.length-1&&g.length>1&&i.jsx("span",{className:"ml-1 text-xs",children:"max"})]},S))})]})})]})})})}function ut({amazonCountry:e}){const t=oe.find(u=>u.country==e);if(!t)return;const n=/p_6%[A-Z0-9p_]+/,o=n.test(window.location.href),r=M(),s=(u,a)=>{if(a){const d=window.location.href.match(n);window.location.href=window.location.href.replace(d?d[0]:u,"")}else window.location.href=window.location.href+"&emi="+u};return i.jsxs("div",{className:"mb-4",children:[i.jsx("p",{className:"font-bold",children:w.i18n.getMessage("sale_shipping_filter_header")}),i.jsxs("div",{role:"button",tabIndex:0,onKeyDown:u=>{(u.key==="Enter"||u.key===" ")&&s(t.emi,o)},className:"space-x-1 hover:text-orange-500",onClick:()=>s(t.emi,o),children:[i.jsx("input",{className:"h-4 w-4 cursor-pointer border-r-2 align-middle",type:"checkbox",checked:o,onClick:()=>s(t.emi,o)}),i.jsx("span",{className:"text-sm",children:w.i18n.getMessage("sale_shipping_filter")})]}),i.jsxs("p",{className:"text-xs",children:["powered by"," ",i.jsx("a",{href:r,target:"_blank",rel:"noreferrer",className:"whitespace-nowrap font-bold text-orange-500 hover:underline",children:"EuroSaver"})]})]})}async function k(e){return new Promise(t=>{const n=document.querySelector(e);if(n){t(n);return}const o=()=>{t(void 0)};if(document.readyState==="complete"){o();return}const r=new MutationObserver((u,a)=>{const d=document.querySelector(e);d&&(a.disconnect(),t(d))});r.observe(document.documentElement,{childList:!0,subtree:!0});const s=()=>{r.disconnect(),document.removeEventListener("DOMContentLoaded",s),o()};document.addEventListener("DOMContentLoaded",s)})}async function dt(e){for(const t of e){const n=await k(t);if(n)return n}}async function L(e,t){const n="eurosaver",o=await dt(e.selectors);if(!o||o.hasAttribute(n))return;o.setAttribute(n,"true");const r=document.createElement("div"),s=r.attachShadow({mode:"closed"}),u=ee(s);o.insertAdjacentElement(e.position,r),await Promise.all(e.cssPaths.map(a=>{const d=document.createElement("link");return d.setAttribute("rel","stylesheet"),d.setAttribute("href",w.runtime.getURL(a)),s.appendChild(d),new Promise(p=>{d.onload=p})})),u.render(t())}const{useArticleStore:ft,initializeArticleStore:mt}=Q();function pt({amazonCountry:e,currencyInfo:t,ad:n}){const o=ft(p=>p.articles),[r]=A("includeShippingCostsDefault",!1),[s,u]=A("includeShippingCosts",!1);b.useEffect(()=>{r&&u(r)},[r,u]),b.useEffect(()=>{mt()},[]);const a=M(),d=H();return i.jsxs("div",{className:"my-1 divide-y",children:[i.jsxs("div",{className:"flex flex-row items-center justify-between gap-2 p-1 font-semibold text-neutral-400",children:[i.jsx("a",{className:"flex-1",href:a,target:"_blank",rel:"noreferrer",children:i.jsx("img",{src:new URL(J,import.meta.url).href,alt:"EuroSaver Logo",width:2569,height:504,className:"h-6 w-auto"})}),i.jsx("button",{onClick:p=>{p.preventDefault(),u(!s)},title:w.i18n.getMessage("include_shipping"),className:"items-center rounded-md p-2 transition-all duration-200 ease-in-out hover:bg-zinc-200 hover:text-orange-400",children:i.jsx(xe,{className:`h-4 transition-all duration-200 ease-in-out group-hover:translate-x-1 ${s&&"text-orange-500"}`})}),i.jsx("button",{onClick:p=>{p.preventDefault(),d.openOptionsPage()},title:w.i18n.getMessage("options_header"),className:"items-center rounded-md p-2 transition-all duration-200 ease-in-out hover:bg-zinc-200 hover:text-orange-400",children:i.jsx(be,{className:"h-4 transition-all duration-200 ease-in-out group-hover:translate-x-1"})})]}),o.length==0&&i.jsx(Ee,{}),o.length>0&&i.jsx(we,{articles:o,amazonCountry:e,currencyInfo:t,includeShippingCosts:s}),o.length>0&&n&&i.jsx(_e,{ad:n})]})}je.log("settings",await se());const Y="#s-refinements",W=new DOMParser;de(e=>{w.runtime.onMessage.addListener((t,n,o)=>(e(t,o),!0))},{getArticle:$(x.object({html:x.string(),country:x.object({domain:x.string(),id:x.string(),displayName:x.string(),tag:x.string(),currency:x.object({id:x.string(),symbol:x.string(),displayName:x.string()})}),asin:x.string()}),e=>{const t=W.parseFromString(e.html,"text/html");return ae(t,e.country,e.asin)}),extractArticleData:$(x.object({html:x.string()}),e=>ce(W.parseFromString(e.html,"text/html")))});async function ht(e){const t=await k("body");if(t){let n=location.href,o=U(location.href);o&&e(o),F.resetBadgeCount(),F.setBadgeIconInactive();const r=new MutationObserver(u=>{u.forEach(()=>{if(n!=document.location.href){n=document.location.href;const a=U(location.href);a&&o!==a&&(e(a),o=a)}})}),s={childList:!0,subtree:!0};r.observe(t,s)}}async function gt(e){const t=await k("body");if(t){let n=location.href;e();const o=new MutationObserver(s=>{s.forEach(()=>{n!=document.location.href&&t.querySelector(Y)&&(n=document.location.href,e())})}),r={childList:!0,subtree:!0};o.observe(t,r)}}const F=H();(async function(){const t=await R("showSaleAndShippingByAmazonFilter"),n=ie(location.href);if(!n)return;t&&await gt(()=>{L({selectors:[Y],cssPaths:["assets/index-BLsMbezK.css"],position:"beforebegin"},()=>i.jsx(N.StrictMode,{children:i.jsx("div",{className:"eurosaver-style-reset",children:i.jsx(ut,{amazonCountry:n})})}))});const o=await R("enableInpageView"),r=await R("enablePriceIndicator");if(o||r){const s=await Ae();await ht(async u=>{const a=le(location.href);if(!n||!u)return;const d=await Ce({asin:u,name:a,amazonCountry:n});F.readAndPostArticles(),o&&L({selectors:["#corePriceDisplay_desktop_feature_div","#corePrice_desktop"],cssPaths:["assets/index-BLsMbezK.css"],position:"afterend"},()=>i.jsx(N.StrictMode,{children:i.jsx("div",{className:"eurosaver-style-reset",children:i.jsx(pt,{name:a,amazonCountry:n,asin:u,currencyInfo:s,ad:d})})})),r&&L({selectors:["#dealBadge_feature_div","#apex_desktop"],cssPaths:["assets/index-BLsMbezK.css"],position:"afterbegin"},()=>i.jsx(N.StrictMode,{children:i.jsx("div",{className:"eurosaver-style-reset",children:i.jsx(lt,{amazonCountry:n,currencyInfo:s})})}))})}})();
